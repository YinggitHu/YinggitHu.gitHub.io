var Client=require("../constants/client");module.exports=HandshakeInitializationPacket;function HandshakeInitializationPacket(a){a=a||{};this.protocolVersion=a.protocolVersion;this.serverVersion=a.serverVersion;this.threadId=a.threadId;this.scrambleBuff1=a.scrambleBuff1;this.filler1=a.filler1;this.serverCapabilities1=a.serverCapabilities1;this.serverLanguage=a.serverLanguage;this.serverStatus=a.serverStatus;this.serverCapabilities2=a.serverCapabilities2;this.scrambleLength=a.scrambleLength;this.filler2=a.filler2;this.scrambleBuff2=a.scrambleBuff2;this.filler3=a.filler3;this.pluginData=a.pluginData;this.protocol41=a.protocol41;if(this.protocol41){this.serverCapabilities1|=Client.CLIENT_PROTOCOL_41}}HandshakeInitializationPacket.prototype.parse=function(b){this.protocolVersion=b.parseUnsignedNumber(1);this.serverVersion=b.parseNullTerminatedString();this.threadId=b.parseUnsignedNumber(4);this.scrambleBuff1=b.parseBuffer(8);this.filler1=b.parseFiller(1);this.serverCapabilities1=b.parseUnsignedNumber(2);this.serverLanguage=b.parseUnsignedNumber(1);this.serverStatus=b.parseUnsignedNumber(2);this.protocol41=(this.serverCapabilities1&(1<<9))>0;if(this.protocol41){this.serverCapabilities2=b.parseUnsignedNumber(2);this.scrambleLength=b.parseUnsignedNumber(1);this.filler2=b.parseFiller(10);this.scrambleBuff2=b.parseBuffer(12);this.filler3=b.parseFiller(1)}else{this.filler2=b.parseFiller(13)}if(b.reachedPacketEnd()){return}this.pluginData=b.parsePacketTerminatedString();var a=this.pluginData.length-1;if(this.pluginData[a]==="\0"){this.pluginData=this.pluginData.substr(0,a)}};HandshakeInitializationPacket.prototype.write=function(a){a.writeUnsignedNumber(1,this.protocolVersion);a.writeNullTerminatedString(this.serverVersion);a.writeUnsignedNumber(4,this.threadId);a.writeBuffer(this.scrambleBuff1);a.writeFiller(1);a.writeUnsignedNumber(2,this.serverCapabilities1);a.writeUnsignedNumber(1,this.serverLanguage);a.writeUnsignedNumber(2,this.serverStatus);if(this.protocol41){a.writeUnsignedNumber(2,this.serverCapabilities2);a.writeUnsignedNumber(1,this.scrambleLength);a.writeFiller(10)}a.writeNullTerminatedBuffer(this.scrambleBuff2);if(this.pluginData!==undefined){a.writeNullTerminatedString(this.pluginData)}};HandshakeInitializationPacket.prototype.scrambleBuff=function(){var a=new Buffer(this.scrambleBuff1.length+(typeof this.scrambleBuff2!=="undefined"?this.scrambleBuff2.length:0));this.scrambleBuff1.copy(a);if(typeof this.scrambleBuff2!=="undefined"){this.scrambleBuff2.copy(a,this.scrambleBuff1.length)}return a};