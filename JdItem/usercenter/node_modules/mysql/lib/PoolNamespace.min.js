var Connection=require("./Connection");var PoolSelector=require("./PoolSelector");module.exports=PoolNamespace;function PoolNamespace(b,c,a){this._cluster=b;this._pattern=c;this._selector=new PoolSelector[a]()}PoolNamespace.prototype.getConnection=function(c){var b=this._getClusterNode();var a=this._cluster;var d=this;if(b===null){var e=null;if(this._cluster._findNodeIds(this._pattern,true).length!==0){e=new Error("Pool does not have online node.");e.code="POOL_NONEONLINE"}else{e=new Error("Pool does not exist.");e.code="POOL_NOEXIST"}c(e);return}a._getConnection(b,function(h,g){var f=h&&a._canRetry&&a._findNodeIds(d._pattern).length!==0;if(f){d.getConnection(c);return}if(h){c(h);return}c(null,g)})};PoolNamespace.prototype.query=function(h,d,c){var b=this._cluster;var a=this._getClusterNode();var g=Connection.createQuery(h,d,c);var e=this;if(a===null){var f=null;if(this._cluster._findNodeIds(this._pattern,true).length!==0){f=new Error("Pool does not have online node.");f.code="POOL_NONEONLINE"}else{f=new Error("Pool does not exist.");f.code="POOL_NOEXIST"}process.nextTick(function(){g.on("error",function(){});g.end(f)});return g}if(!(typeof h==="object"&&"typeCast" in h)){g.typeCast=a.pool.config.connectionConfig.typeCast}if(a.pool.config.connectionConfig.trace){g._callSite=new Error()}b._getConnection(a,function(k,j){var i=k&&b._canRetry&&b._findNodeIds(e._pattern).length!==0;if(i){e.query(g);return}if(k){g.on("error",function(){});g.end(k);return}g.once("end",function(){j.release()});j.query(g)});return g};PoolNamespace.prototype._getClusterNode=function _getClusterNode(){var a=this._cluster._findNodeIds(this._pattern);var b;switch(a.length){case 0:b=null;break;case 1:b=a[0];break;default:b=this._selector(a);break}return b!==null?this._cluster._getNode(b):null};