var urlParse=require("url").parse;var ClientConstants=require("./protocol/constants/client");var Charsets=require("./protocol/constants/charsets");var SSLProfiles=null;module.exports=ConnectionConfig;function ConnectionConfig(a){if(typeof a==="string"){a=ConnectionConfig.parseUrl(a)}this.host=a.host||"localhost";this.port=a.port||3306;this.localAddress=a.localAddress;this.socketPath=a.socketPath;this.user=a.user||undefined;this.password=a.password||undefined;this.database=a.database;this.connectTimeout=(a.connectTimeout===undefined)?(10*1000):a.connectTimeout;this.insecureAuth=a.insecureAuth||false;this.supportBigNumbers=a.supportBigNumbers||false;this.bigNumberStrings=a.bigNumberStrings||false;this.dateStrings=a.dateStrings||false;this.debug=a.debug;this.trace=a.trace!==false;this.stringifyObjects=a.stringifyObjects||false;this.timezone=a.timezone||"local";this.flags=a.flags||"";this.queryFormat=a.queryFormat;this.pool=a.pool||undefined;this.ssl=(typeof a.ssl==="string")?ConnectionConfig.getSSLProfile(a.ssl):(a.ssl||false);this.multipleStatements=a.multipleStatements||false;this.typeCast=(a.typeCast===undefined)?true:a.typeCast;if(this.timezone[0]===" "){this.timezone="+"+this.timezone.substr(1)}if(this.ssl){this.ssl.rejectUnauthorized=this.ssl.rejectUnauthorized!==false}this.maxPacketSize=0;this.charsetNumber=(a.charset)?ConnectionConfig.getCharsetNumber(a.charset):a.charsetNumber||Charsets.UTF8_GENERAL_CI;var b=ConnectionConfig.getDefaultFlags(a);this.clientFlags=ConnectionConfig.mergeFlags(b,a.flags)}ConnectionConfig.mergeFlags=function mergeFlags(f,d){var e=ConnectionConfig.parseFlagList(f);var c=ConnectionConfig.parseFlagList(d);for(var b in c){if(e[b]!==false){e[b]=c[b]}}var a=0;for(var b in e){if(e[b]){a|=ClientConstants["CLIENT_"+b]||0}}return a};ConnectionConfig.getCharsetNumber=function getCharsetNumber(b){var a=Charsets[b.toUpperCase()];if(a===undefined){throw new TypeError("Unknown charset '"+b+"'")}return a};ConnectionConfig.getDefaultFlags=function getDefaultFlags(a){var b=["-COMPRESS","-CONNECT_ATTRS","+CONNECT_WITH_DB","+FOUND_ROWS","+IGNORE_SIGPIPE","+IGNORE_SPACE","+LOCAL_FILES","+LONG_FLAG","+LONG_PASSWORD","+MULTI_RESULTS","+ODBC","-PLUGIN_AUTH","+PROTOCOL_41","+PS_MULTI_RESULTS","+RESERVED","+SECURE_CONNECTION","+TRANSACTIONS"];if(a&&a.multipleStatements){b.push("+MULTI_STATEMENTS")}return b};ConnectionConfig.getSSLProfile=function getSSLProfile(b){if(!SSLProfiles){SSLProfiles=require("./protocol/constants/ssl_profiles")}var a=SSLProfiles[b];if(a===undefined){throw new TypeError("Unknown SSL profile '"+b+"'")}return a};ConnectionConfig.parseFlagList=function parseFlagList(c){var e=Object.create(null);if(!c){return e}var b=!Array.isArray(c)?String(c||"").toUpperCase().split(/\s*,+\s*/):c;for(var d=0;d<b.length;d++){var a=b[d];var g=1;var f=a[0];if(f===undefined){continue}if(f!=="-"&&f!=="+"){g=0;f="+"}e[a.substr(g)]=f==="+"}return e};ConnectionConfig.parseUrl=function(b){b=urlParse(b,true);var a={host:b.hostname,port:b.port,database:b.pathname.substr(1)};if(b.auth){var e=b.auth.split(":");a.user=e.shift();a.password=e.join(":")}if(b.query){for(var c in b.query){var f=b.query[c];try{a[c]=JSON.parse(f)}catch(d){a[c]=f}}}return a};